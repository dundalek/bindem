(function(k){if("function"===typeof define&&define.amd)define(["jquery","underscore"],k);else if("undefined"!==typeof exports&&"undefined"!==typeof require){var j=require("jQuery"),c=require("underscore");c.extend(exports,k(j,c))}else window.Bindem=k(window.jQuery,window._)})(function(k,j){var c={_bind:function(b,a,f,h){var e=this,g=b.accessor,d=b.model||a.model||e.model;(b.selector?a.root.find(b.selector):a.root).each(function(){var l=k(this);"string"===typeof d&&(d=e[d]);"string"===typeof b.accessor&&
(g=function(a,f){return void 0===f?a[b.accessor]():a[b.accessor](f)});(f||c._bindModel).call(e,d,l,g,b,a);(h||c._bindView).call(e,d,l,g,b,a)})},_bindModel:function(b,a,f,h,e){var g=this;if(b&&e.attr){var d=function(){var a=b.get(e.attr);return"function"===typeof h.m2v?h.m2v(a):a},c=function(){var b=d(),c=Array.prototype.slice.call(arguments);c.unshift(void 0);c.unshift(a);var h=f.apply(g,c);b!==h&&(c[1]=b,f.apply(g,c))};e.initialize&&f.call(g,a,d());b.on("change:"+e.attr,c,g);b.on("sync",c,g)}},_bindView:function(b,
a,f,c,e){var g=this;if(c.event&&e.attr)a.on(c.event+".bindem",function(){var d=Array.prototype.slice.call(arguments);d.unshift(void 0);d.unshift(a);var d=f.apply(g,d),l=b.get(e.attr),d="function"===typeof c.v2m?c.v2m(d):d;l!==d&&b.set(e.attr,d)})},_loadBindings:function(b,a,f){var a=a||{},h=this;j.each(b||{},function(b,g){j.each(b,function(b,e){b instanceof Array||(b=[b]);j.each(b,function(b){"string"===typeof b&&(b={selector:b});var d=j.extend({attr:g},a);d.root=a.root?k(a.root):h.$el;d.attr=g;var i=
e;c.bindings[e]&&(i=c.bindings[e]);f.call(h,i,b,d)})})})},on:function(b,a){c._loadBindings.call(this,b,a,function(b,a,e){(b.init||function(a,d){c._bind.call(this,j.extend({},b,a),d)}).call(this,a,e)})},off:function(b,a){c._loadBindings.call(this,b,a,function(b,a,c){(b.destroy||function(a,c){var a=j.extend({},b,a),e=a.model||c.model||this.model,h=a.selector?c.root.find(a.selector):c.root;a.event&&h.off(a.event+".bindem");e&&e.off("change:"+c.attr,null,this)}).call(this,a,c)})}},i={custom:{},value:{accessor:"val",
event:"change"},html:{accessor:"html"},text:{accessor:"text"},visible:{accessor:function(b,a){if(void 0===a)return b.is(":visible");b[a?"show":"hide"]()}},hidden:{accessor:function(b,a){return!c.bindings.visible.accessor(b,void 0===a?a:!a)}},disable:{accessor:function(b,a){if(void 0===a)return b.prop("disabled");b.prop("disabled",a)}},enable:{accessor:function(b,a){return!c.bindings.disable.accessor(b,void 0===a?a:!a)}},hasfocus:{event:"focus blur",accessor:function(b,a,c){if(void 0===a)return"focus"===
c.type?!0:"blur"===c.type?!1:b.is(":focus");b[a?"focus":"blur"]()}}};j.each({css:function(b,a,c){if(void 0===c)return a.hasClass(b);a[c?"addClass":"removeClass"](b)},style:function(b,a,c){if(void 0===c)return a.css(b);a.css(b,c)},attr:function(b,a,c){if(void 0===c)return a.attr(b);a.attr(b,c)}},function(b,a){i[a]={init:function(a,h){var e=this;j.each(a,function(a,d){var f="object"===typeof a?a:{selector:a};f.accessor=function(a,c){b.call(this,d,a,c)};c._bind.call(e,f,h)})},accessor:b}});i.change=
{init:function(b,a){b.selector&&"string"===typeof b.selector&&(b=this[b.selector]);c._bind.call(this,{accessor:function(a,c){void 0!==c&&b.call(this,c)}},a)}};i.checked={init:function(b,a){c._bind.call(this,j.extend({},i.checked,b),a,null,function(){c._bindView.apply(this,arguments);var a=arguments[1];a.is(":radio")&&!a.attr("name")&&i.uniqueName._assignUniqueName(null,a)})},event:"click",accessor:function(b,a){if(b.is("[type=radio]")){if(void 0===a)return(b.prop("checked")?"":"_")+b.val();b.prop("checked",
b.val()===a)}else{if(void 0===a)return b.prop("checked");b.prop("checked",a)}}};i.uniqueName={init:function(b,a){c._bind.call(this,b,a,null,i.uniqueName._assignUniqueName)},_assignUniqueName:function(b,a){a.attr("name","bindem_unique_"+ ++i.uniqueName._currentIndex)},_currentIndex:0};c.bindings=i;return c});

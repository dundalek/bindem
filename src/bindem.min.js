(function(j){if("function"===typeof define&&define.amd)define(["jquery","underscore"],j);else if("undefined"!==typeof exports&&"undefined"!==typeof require){var g=require("jQuery"),c=require("underscore");c.extend(exports,j(g,c))}else window.Bindem=j(window.jQuery,window._)})(function(j,g){var c={_bind:function(b,a,d,k){var f=this,i=b.accessor,e=b.model||a.model||f.model;(b.selector?a.root.find(b.selector):a.root).each(function(){var g=j(this);"string"===typeof e&&(e=f[e]);"string"===typeof b.accessor&&
(i=function(a,d){return void 0===d?a[b.accessor]():a[b.accessor](d)});(d||c._bindModel).call(f,e,g,i,b,a);(k||c._bindView).call(f,e,g,i,b,a)})},_bindModel:function(b,a,d,c,f){var i=this;b&&f.attr&&(f.initialize&&d.call(i,a,b.get(f.attr)),b.on("change:"+f.attr,function(){var e=Array.prototype.slice.call(arguments);e.unshift(b.get(f.attr));e.unshift(a);d.apply(i,e)},i))},_bindView:function(b,a,d,c,f){var i=this;if(c.event&&f.attr)a.on(c.event+".bindem",function(){var e=Array.prototype.slice.call(arguments);
e.unshift(void 0);e.unshift(a);b.set(f.attr,d.apply(i,e))})},_loadBindings:function(b,a,d){var a=a||{},k=this;g.each(b||{},function(b,i){g.each(b,function(b,f){b instanceof Array||(b=[b]);g.each(b,function(b){"string"===typeof b&&(b={selector:b});var e=g.extend({attr:i},a);e.root=a.root?j(a.root):k.$el;e.attr=i;var h=f;c.bindings[f]&&(h=c.bindings[f]);d.call(k,h,b,e)})})})},on:function(b,a){c._loadBindings.call(this,b,a,function(b,a,f){(b.init||function(a,e){c._bind.call(this,g.extend({},b,a),e)}).call(this,
a,f)})},off:function(b,a){c._loadBindings.call(this,b,a,function(b,a,c){(b.destroy||function(a,e){var a=g.extend({},b,a),c=a.model||e.model||this.model,f=a.selector?e.root.find(a.selector):e.root;a.event&&f.off(a.event+".bindem");c&&c.off("change:"+e.attr,null,this)}).call(this,a,c)})}},h={custom:{},value:{accessor:"val",event:"change"},html:{accessor:"html"},text:{accessor:"text"},visible:{accessor:function(b,a){if(void 0===a)return b.is(":visible");b[a?"show":"hide"]()}},hidden:{accessor:function(b,
a){return!c.bindings.visible.accessor(b,void 0===a?a:!a)}},disable:{accessor:function(b,a){if(void 0===a)return b.prop("disabled");b.prop("disabled",a)}},enable:{accessor:function(b,a){return!c.bindings.disable.accessor(b,void 0===a?a:!a)}},hasfocus:{event:"focus blur",accessor:function(b,a,d){if(void 0===a)return"focus"===d.type?!0:"blur"===d.type?!1:b.is(":focus");b[a?"focus":"blur"]()}}};g.each({css:function(b,a,d){if(void 0===d)return a.hasClass(b);a[d?"addClass":"removeClass"](b)},style:function(b,
a,d){if(void 0===d)return a.css(b);a.css(b,d)},attr:function(b,a,d){if(void 0===d)return a.attr(b);a.attr(b,d)}},function(b,a){h[a]={init:function(a,h){var f=this;g.each(a,function(a,d){c._bind.call(f,{accessor:function(a,c){b.call(this,d,a,c)},selector:a},h)})},accessor:b}});h.change={init:function(b,a){b.selector&&"string"===typeof b.selector&&(b=this[b.selector]);c._bind.call(this,{accessor:function(a,c){b.call(this,c)}},a)}};h.checked={init:function(b,a){c._bind.call(this,g.extend({},h.checked,
b),a,null,function(){c._bindView.apply(this,arguments);var a=arguments[1];a.is(":radio")&&!a.attr("name")&&h.uniqueName._assignUniqueName(null,a)})},event:"click",accessor:function(b,a){if(b.is("[type=radio]")){if(void 0===a)return b.val();b.prop("checked",b.val()===a)}else{if(void 0===a)return b.prop("checked");b.prop("checked",a)}}};h.uniqueName={init:function(b,a){c._bind.call(this,b,a,null,h.uniqueName._assignUniqueName)},_assignUniqueName:function(b,a){a.attr("name","bindem_unique_"+ ++h.uniqueName._currentIndex)},
_currentIndex:0};c.bindings=h;return c});
